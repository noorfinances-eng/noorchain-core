syntax = "proto3";

package noorfinances.noorchain.noorsignal;

import "google/protobuf/timestamp.proto";
import "cosmos/base/query/v1beta1/pagination.proto";

// Option go_package pour générer correctement le code Go.
option go_package = "github.com/noorfinances-eng/noorchain-core/x/noorsignal/types";

// ------------------------------------------------------------
//  Messages de base (Signal, Curator, PossConfig)
//
//  Remarque :
//  - Pour l'instant, on redéfinit ici des versions simples des
//    structures déjà présentes en Go (types.Signal, types.Curator,
//    types.PossConfig).
//  - Dans une version plus avancée, on pourra factoriser cela dans
//    un fichier "noorsignal.proto" commun pour les Msg + Query.
// ------------------------------------------------------------

message Signal {
  uint64 id = 1;
  string participant = 2; // bech32
  string curator = 3;     // bech32 (peut être vide si non validé)
  uint32 weight = 4;
  google.protobuf.Timestamp time = 5;
  string metadata = 6;

  uint64 total_reward = 7;
  uint64 reward_participant = 8;
  uint64 reward_curator = 9;
}

message Curator {
  string address = 1; // bech32
  string level = 2;   // BRONZE / SILVER / GOLD
  uint64 total_signals_validated = 3;
  bool active = 4;
}

message PossConfig {
  uint64 base_reward = 1;
  uint32 participant_share = 2;
  uint32 curator_share = 3;
  uint32 max_signals_per_day = 4;
  bool enabled = 5;
  uint32 era_index = 6;
}

// ------------------------------------------------------------
//  Query service
// ------------------------------------------------------------

service Query {
  // Récupère un signal par son identifiant.
  rpc GetSignal (QueryGetSignalRequest) returns (QueryGetSignalResponse);

  // Liste paginée de signaux PoSS.
  rpc ListSignals (QueryListSignalsRequest) returns (QueryListSignalsResponse);

  // Récupère un curator par son adresse.
  rpc GetCurator (QueryGetCuratorRequest) returns (QueryGetCuratorResponse);

  // Liste paginée de curators PoSS.
  rpc ListCurators (QueryListCuratorsRequest) returns (QueryListCuratorsResponse);

  // Récupère la configuration globale PoSS.
  rpc GetConfig (QueryGetConfigRequest) returns (QueryGetConfigResponse);
}

// ------------------------------------------------------------
//  GetSignal
// ------------------------------------------------------------

message QueryGetSignalRequest {
  uint64 signal_id = 1;
}

message QueryGetSignalResponse {
  Signal signal = 1;
}

// ------------------------------------------------------------
//  ListSignals
// ------------------------------------------------------------

message QueryListSignalsRequest {
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

message QueryListSignalsResponse {
  repeated Signal signals = 1;
  cosmos.base.query.v1beta1.PageResponse pagination = 2;
}

// ------------------------------------------------------------
//  GetCurator
// ------------------------------------------------------------

message QueryGetCuratorRequest {
  string address = 1; // bech32
}

message QueryGetCuratorResponse {
  Curator curator = 1;
}

// ------------------------------------------------------------
//  ListCurators
// ------------------------------------------------------------

message QueryListCuratorsRequest {
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

message QueryListCuratorsResponse {
  repeated Curator curators = 1;
  cosmos.base.query.v1beta1.PageResponse pagination = 2;
}

// ------------------------------------------------------------
//  GetConfig
// ------------------------------------------------------------

message QueryGetConfigRequest {}

message QueryGetConfigResponse {
  PossConfig config = 1;
}
